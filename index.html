<!DOCTYPE html>
<html>

<head>
	<title>MarineTraffic and OpenSeaMap</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
	<link rel="stylesheet" href="http://www.jacklmoore.com/colorbox/example1/colorbox.css" />
	<style type="text/css">
		html,
		body,
		#map {
			width: 100%;
			height: 100%;
			margin: 0;
			padding: 0;
		}

		.leaflet-popup-content {
			overflow: hidden;
		}

		.leaflet-popup-content #infopic {
			float: right;
		}

		.leaflet-popup-content #infotext {
			float: left;
		}
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
	<script src="http://rawgithub.com/shramov/leaflet-plugins/master/layer/Marker.Rotate.js"></script>
	<script src="http://rawgithub.com/mlevans/leaflet-hash/master/leaflet-hash.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
	<script src="http://www.jacklmoore.com/colorbox/jquery.colorbox.js"></script>

</head>

<body>
	<div id="map"></div>
	<script src="geojson.js" type="text/javascript"></script>
	<script type="text/javascript">
		//<![CDATA[
		(function ($) {
			$(function () {

				var map = new L.Map('map').setView([58.198395, 11.466894], 16);

				map.attributionControl.setPrefix('').addAttribution('Map data &copy; <a href="http://www.marinetraffic.com">MarineTraffic</a>');

				var hash = new L.Hash(map);

				var positron = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
					subdomains: 'abcd',
					maxZoom: 19
				}).addTo(map);

				openseamap = new L.TileLayer('http://tiles.openseamap.org/seamark/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

				var route = new L.geoJson(routeLine, {
					style: function (feature) {
						return feature.properties.style;
					}
				}).addTo(map);

				var layersControl = new L.Control.Layers({
					'Positron': positron
				}, {
					'OpenSeaMap': openseamap,
					'Route': route
				}).addTo(map);
				
				var boatIcon = new L.Icon({
					iconUrl: 'marker.png',
					shadowUrl: null,
					iconSize: new L.Point(19, 26),
					iconAnchor: new L.Point(9, 13)
				});

				var boat = L.marker([0, 0], {icon: boatIcon}).addTo(map);

				var markerGroup = new L.LayerGroup();

				function loadBoat() {
					var xhttp = new XMLHttpRequest();
					xhttp.onreadystatechange = function () {
						obj = JSON.parse(this.responseText);
						console.log(obj.gps.location.latitude)
						boat.setLatLng([obj.gps.location.latitude, obj.gps.location.longitude])
						boat.setIconAngle(obj.gps.course)
					};
					xhttp.open("GET", "http://127.0.0.1:5000/gps", true);
					xhttp.send();
				}
				loadBoat();
				var myVar = setInterval(loadBoat, 5000);

			});
		})(jQuery);
//]]>
	</script>
</body>

</html>